<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>SSH Log Tools</title>
    <link rel="stylesheet" href="/static/style.css">
  </head>
  <body>
    <header>
      <h1>SSH Log Tools</h1>
      <nav>
        <a href="/">Logs</a>
        <a href="/profiles">Profiles</a>
        <a href="/records">Records</a>
        <a href="/docs" target="_blank">API Docs</a>
      </nav>
      <div class="actions"></div>
    </header>
    <main>
      <aside>
        <div class="panel" style="margin-top:0">
          <h2>Profiles (select to include)</h2>
          <table id="profilesTable">
            <thead><tr><th style="width:28px"></th><th>Name</th><th>Proto</th></tr></thead>
            <tbody></tbody>
          </table>
        
        </div>
      </aside>
      <section class="viewer">
        <div class="controls">
          <div>
            <strong>Scope:</strong> Selected profiles' registered paths
          </div>
          <div>
            <label>Max lines <input id="maxLines" type="number" min="10" max="5000" value="200" /></label>
            <button id="runAll">Run Selected</button>
          </div>
          <div id="runMsg" class="alert info" style="display:none"></div>
        </div>
        <div class="panel" style="margin:10px">
          <table id="resultTable">
            <thead><tr><th>Profile</th><th>Register</th><th>Matches</th></tr></thead>
            <tbody></tbody>
          </table>
        </div>
      </section>
    </main>
    <!-- Record Modal -->
    <div id="recordModal" class="modal">
      <div class="content">
        <h3>Save Record</h3>
        <form id="recordForm">
          <input type="hidden" name="profile_id" />
          <input type="hidden" name="selected_images_json" id="selectedImagesJson" />
          <label>Path
            <input type="text" name="file_path" readonly style="width:100%" />
          </label>
          <label>Title
            <input type="text" name="title" placeholder="Optional title" style="width:100%" />
          </label>
          <div class="grid" style="grid-template-columns:1fr 1fr; gap:10px;">
            <label>Date/Time
              <input type="datetime-local" name="event_dt" />
            </label>
            <label>Situation
              <input type="text" name="situation" placeholder="e.g., Incident, Debug, Note" />
            </label>
          </div>
          <label>Description
            <textarea name="description" placeholder="Describe context or steps" style="width:100%;height:80px"></textarea>
          </label>
          <label>Logs
            <textarea id="recordLineView" name="content" placeholder="Log lines (for text records)" style="width:100%;height:100px"></textarea>
          </label>
          <div>
            <strong>Images</strong>
            <div id="selectedImagesBlock" style="display:none; margin:6px 0;">
              <div id="selectedImagesList" class="panel" style="max-height:180px; overflow:auto"></div>
            </div>
            <div style="margin-top:6px;">
              <input type="file" name="images" multiple accept="image/*" />
            </div>
          </div>
          <div class="actions">
            <button type="button" id="recordCancel">Cancel</button>
            <button type="submit">Save</button>
          </div>
        </form>
      </div>
    </div>
    <!-- Fullscreen Image Viewer -->
    <div id="imgViewer" class="img-viewer">
      <div class="inner">
        <button class="close" id="imgViewClose">Close</button>
        <button class="nav prev" id="imgViewPrev">❮</button>
        <img id="imgViewImg" src="" alt="preview" />
        <button class="nav next" id="imgViewNext">❯</button>
      </div>
    </div>
    <script>
      // mark active nav
      (function(){
        var path = location.pathname.replace(/\/+$/, '') || '/';
        document.querySelectorAll('header nav a').forEach(function(a){
          var href = a.getAttribute('href');
          if(href === path) a.classList.add('active');
        });
      })();
    </script>
    <script>
      window.APP_CFG = {{ (app_cfg or {'apiTimeoutMs':30000}) | tojson }};
    </script>
    <script src="/static/app.js"></script>
  </body>
  </html>
